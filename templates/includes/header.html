<header>
    <div class="logo">T2F about News</div>
    <nav class="nav-links">
        <a href="#">–ù–æ–≤–æ—Å—Ç–∏</a>
        <a href="#">–ü–æ—Å—Ç—ã</a>
        <a href="#">–¢–µ–≥–∏</a>
    </nav>

    <div class="profile-menu">
        <button class="profile-btn" id="profileBtn">
            <div class="profile-avatar" id="userAvatar">–ò–ò</div>
            <span id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </button>
        
        <div class="dropdown" id="profileDropdown">
            <div class="dropdown-item">
                <i class="icon">üë§</i>
                <span>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</span>
            </div>
            <div class="dropdown-item">
                <i class="icon">‚öôÔ∏è</i>
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </div>
            <div class="dropdown-item">
                <i class="icon">üñºÔ∏è</i>
                <span>–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</span>
            </div>
            <div class="dropdown-item">
                <i class="icon">üîí</i>
                <span>–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</span>
            </div>
            <div class="dropdown-divider"></div>
            <div class="dropdown-item" id="logoutBtn">
                <i class="icon">üö™</i>
                <span>–í—ã–π—Ç–∏</span>
            </div>
        </div>
    </div>
</header>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        if (!localStorage.getItem('access_token')) {
            window.location.href = '/auth/signin/';
            return;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            try {
                const response = await fetch('/api/users/me/', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) return null;
                return await response.json();
            } catch {
                return null;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUserProfile(userData) {
            const userNameElement = document.getElementById('userName');
            const avatarElement = document.getElementById('userAvatar');
            
            if (userData?.first_name && userData?.last_name) {
                userNameElement.textContent = `${userData.first_name} ${userData.last_name}`;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏
                if (userData.avatar) {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å URL –∞–≤–∞—Ç–∞—Ä–∫–∏ - –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    avatarElement.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = userData.avatar;
                    img.alt = '–ê–≤–∞—Ç–∞—Ä';
                    img.onerror = () => {
                        // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã
                        avatarElement.textContent = userData.first_name[0] + userData.last_name[0];
                        avatarElement.style.display = 'flex'; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º flex –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–æ–≤
                    };
                    avatarElement.appendChild(img);
                    avatarElement.style.display = 'block'; // –ú–µ–Ω—è–µ–º –Ω–∞ block –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                } else {
                    // –ï—Å–ª–∏ –Ω–µ—Ç –∞–≤–∞—Ç–∞—Ä–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã
                    avatarElement.textContent = userData.first_name[0] + userData.last_name[0];
                    avatarElement.style.display = 'flex'; // Flex –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–æ–≤
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é
        function initDropdownMenu() {
            const profileBtn = document.getElementById('profileBtn');
            const dropdown = document.getElementById('profileDropdown');
            
            if (!profileBtn || !dropdown) return;
            
            // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
            const newProfileBtn = profileBtn.cloneNode(true);
            const newDropdown = dropdown.cloneNode(true);
            
            profileBtn.replaceWith(newProfileBtn);
            dropdown.replaceWith(newDropdown);
            
            // –ù–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            document.getElementById('profileBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('profileDropdown').classList.toggle('show');
            });
            
            document.addEventListener('click', function(e) {
                const dropdown = document.getElementById('profileDropdown');
                const profileBtn = document.getElementById('profileBtn');
                
                if (!dropdown.contains(e.target) && e.target !== profileBtn) {
                    dropdown.classList.remove('show');
                }
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞
        function initLogout() {
            document.getElementById('logoutBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token');
                localStorage.removeItem('user_profile');
                window.location.href = '/auth/signin/';
            });
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        try {
            initDropdownMenu();
            const userData = await loadUserData();
            
            if (userData) {
                updateUserProfile(userData);
                localStorage.setItem('user_profile', JSON.stringify(userData));
                initDropdownMenu();
            }
            
            initLogout();
        } catch {
            document.getElementById('userName').textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
        }
    });
</script>